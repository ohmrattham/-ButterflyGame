<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <title>‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f5f5dc;
    }

    #intro {
      background: url('intro4.png') center/cover no-repeat;
      width: 100%;
      max-width: 600px;
      margin: auto;
      aspect-ratio: 1080 / 1920;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      padding: 20px;
    }

    #startBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1.2em;
      border: none;
      border-radius: 10px;
      background: darkorange;
      color: white;
      cursor: pointer;
    }

    #game,
    #section2,
    #section3 {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: auto;
      aspect-ratio: 1080 / 1920;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      padding-bottom: 20px;
      display: none;
    }

    .drop-zone {
      position: absolute;
      width: 18%;
      height: 10%;
      border: 2px dashed #888;
      border-radius: 12px;
      z-index: 2;
    }

    .drag-image {
      position: absolute;
      width: 18%;
      cursor: grab;
      z-index: 3;
    }

    #popup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      font-size: 1.5em;
      font-weight: bold;
      border-radius: 20px;
      display: none;
      z-index: 999;
      text-align: center;
      white-space: pre-line;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }

    .buttonContainer {
      position: absolute;
      bottom: 2%;
      width: 100%;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      z-index: 5;
    }

    button {
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      color: white;
    }

    #checkBtn,
    #checkBtn2,
    #checkBtn3 {
      background: green;
    }

    #resetBtn {
      background: crimson;
    }

    .select-image {
      position: absolute;
      width: 30%;
      margin: 10px;
      border: 4px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .select-image.selected {
      filter: drop-shadow(0 0 10px #ffff00) drop-shadow(0 0 20px #ffff00);
      animation: glowPulse 1.5s infinite;
    }

    @keyframes glowPulse {
      0% {
        filter: drop-shadow(0 0 5px #ffff00) drop-shadow(0 0 10px #ffff00);
      }

      50% {
        filter: drop-shadow(0 0 20px #ffff00) drop-shadow(0 0 30px #ffff00);
      }

      100% {
        filter: drop-shadow(0 0 5px #ffff00) drop-shadow(0 0 10px #ffff00);
      }
    }

    #bf1,
    #bf2,
    #bf3,
    #bf4,
    #bf5,
    #bf6,
    #bf7,
    #bf8,
    #bf9,
    #bf10 {
      position: absolute;
    }
  </style>
</head>

<body>
  <canvas id="fireworks"
    style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:10;"></canvas>

  <div id="intro">
    <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
  </div>

  <audio id="backgroundSound" src="bgmusic.mp3" preload="auto" loop></audio>
  <audio id="clickSound" src="click.mp3" preload="auto"></audio>
  <audio id="soundSuccess" src="success.mp3" preload="auto"></audio>
  <audio id="soundFail" src="fail.mp3" preload="auto"></audio>

  <div id="popup" class="popup"></div>

  <!-- ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 1: Drag & Drop -->
  <div id="game" style="background-image: url('bg41.png');">
    <div id="overlayContainer"></div>
    <div class="buttonContainer">
      <button id="checkBtn">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
      <button id="resetBtn">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
    </div>
  </div>

  <!-- ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå -->
  <div id="section2" style="background-image: url('bg42.png');">
    <div id="butterflyOptions">
      <img id="bf1" src="bf1.png" class="select-image" data-name="protected" style="top:30%; left:13%;" />
      <img id="bf2" src="bf2.png" class="select-image" data-name="normal" style="top:30%; left:48%;" />
      <img id="bf3" src="bf3.png" class="select-image" data-name="normal" style="top:48%; left:13%;" />
      <img id="bf4" src="bf4.png" class="select-image" data-name="protected" style="top:48%; left:48%;" />
      <img id="bf5" src="bf5.png" class="select-image" data-name="normal" style="top:63%; left:13%;" />
      <img id="bf6" src="bf6.png" class="select-image" data-name="protected" style="top:63%; left:48%;" />
    </div>
    <div class="buttonContainer">
      <button id="checkBtn2">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
    </div>
  </div>

  <!-- ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå -->
  <div id="section3" style="background-image: url('bg43.png');">
    <div id="butterflyOptions2">
      <img id="bf7" src="bf7.png" class="select-image" data-name="normal" style="top:30%; left:13%;" />
      <img id="bf8" src="bf8.png" class="select-image" data-name="normal" style="top:30%; left:48%;" />
      <img id="bf9" src="bf9.png" class="select-image" data-name="protected" style="top:55%; left:13%;" />
      <img id="bf10" src="bf10.png" class="select-image" data-name="normal" style="top:55%; left:48%;" />
    </div>
    <div class="buttonContainer">
      <button id="checkBtn3">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
    </div>
  </div>

  <script>
    document.getElementById("startBtn").addEventListener("click", () => {
      document.getElementById("intro").style.display = "none";
      document.getElementById("game").style.display = "block";
      document.getElementById("backgroundSound").play();
      createElements();
    });

    const dropZones = [
      { top: 32, left: 40, answer: "butterfly" },
      { top: 48, left: 60, answer: "egg" },
      { top: 63, left: 40, answer: "caterpillar" },
      { top: 48, left: 20, answer: "chrysalis" },
    ];

    const images = [
      { src: "egg.png", name: "egg", top: 78, left: 10 },
      { src: "caterpillar.png", name: "caterpillar", top: 75, left: 30 },
      { src: "chrysalis.png", name: "chrysalis", top: 73, left: 50 },
      { src: "butterfly.png", name: "butterfly", top: 77, left: 70 },
    ];

    const container = document.getElementById("overlayContainer");

    function createElements() {
      container.innerHTML = "";
      dropZones.forEach(zone => {
        const div = document.createElement("div");
        div.className = "drop-zone";
        div.style.top = zone.top + "%";
        div.style.left = zone.left + "%";
        div.dataset.answer = zone.answer;
        container.appendChild(div);
      });

      images.forEach(img => {
        const image = document.createElement("img");
        image.src = img.src;
        image.className = "drag-image";
        image.style.top = img.top + "%";
        image.style.left = img.left + "%";
        image.setAttribute("draggable", true);
        image.dataset.name = img.name;
        container.appendChild(image);
      });

      setupDragEvents();
    }

    function setupDragEvents() {
      let draggedItem = null;
      document.querySelectorAll(".drag-image").forEach(img => {
        img.addEventListener("dragstart", () => {
          draggedItem = img;
        });
      });

      document.querySelectorAll(".drop-zone").forEach(zone => {
        zone.addEventListener("dragover", e => e.preventDefault());
        zone.addEventListener("drop", e => {
          e.preventDefault();
          if (draggedItem) {
            zone.innerHTML = "";
            zone.appendChild(draggedItem);
            draggedItem.style = "position: relative; width: 100%; top: 0; left: 0; z-index:1;";
          }
        });
      });
    }

    function showPopup(text, type = "success") {
      const popup = document.getElementById("popup");
      const sound = document.getElementById(type === "success" ? "soundSuccess" : "soundFail");
      popup.innerText = text;
      popup.style.display = "block";
      sound.currentTime = 0;
      sound.play();
      setTimeout(() => popup.style.display = "none", 3000);
    }

    document.getElementById("checkBtn").addEventListener("click", () => {
      let correct = 0;
      document.querySelectorAll(".drop-zone").forEach(zone => {
        const child = zone.querySelector("img");
        if (child && child.dataset.name === zone.dataset.answer) correct++;
      });
      if (correct === 4) {
        showPopup("‡∏ú‡πà‡∏≤‡∏ô! \n ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 2");
        setTimeout(() => {
          document.getElementById("game").style.display = "none";
          document.getElementById("section2").style.display = "block";
          setupSelectEvents("#section2 .select-image");
        }, 3000);
      } else {
        showPopup("‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î\n‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!", "fail");
      }
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      createElements();
    });

    function setupSelectEvents(selector) {
      const clickSound = document.getElementById("clickSound");
      document.querySelectorAll(selector).forEach(img => {
        img.addEventListener("click", () => {
          img.classList.toggle("selected");
          clickSound.currentTime = 0;
          clickSound.play();
        });
      });
    }

    document.getElementById("checkBtn2").addEventListener("click", () => {
      const selected = document.querySelectorAll("#section2 .select-image.selected");
      let correct = 0, wrong = false;
      selected.forEach(img => {
        if (img.dataset.name === "protected") correct++;
        else wrong = true;
      });

      const totalCorrect = document.querySelectorAll('#section2 .select-image[data-name="protected"]').length;
      if (correct === totalCorrect && !wrong) {
        showPopup("‡∏ú‡πà‡∏≤‡∏ô! \n ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 3");
        setTimeout(() => {
          document.getElementById("section2").style.display = "none";
          document.getElementById("section3").style.display = "block";
          setupSelectEvents("#section3 .select-image");
        }, 3000);
      } else {
        showPopup("‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î\n‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà!", "fail");
      }
    });

    document.getElementById("checkBtn3").addEventListener("click", () => {
      const selected = document.querySelectorAll("#section3 .select-image.selected");
      let correct = 0, wrong = false;
      selected.forEach(img => {
        if (img.dataset.name === "protected") correct++;
        else wrong = true;
      });

      const isAllCorrect = document.querySelectorAll('#section3 .select-image[data-name="protected"]').length;
      if (isAllCorrect) {
        document.getElementById("soundSuccess").play();
        startFireworks();

        const popup = document.getElementById("popup");
        popup.style.display = "block"; // <-- ‡πÅ‡∏™‡∏î‡∏á popup ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ
        popup.innerText = "‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ";

        setTimeout(() => {
          location.href = "index.html#map";
        }, 4000);
      } else {
        document.getElementById("soundFail").play();

        const popup = document.getElementById("popup");
        popup.style.display = "block";
        popup.innerText = "‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞!";
      }


    });


    function startFireworks() {
      const canvas = document.getElementById("fireworks");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      let particles = [];

      function createFirework() {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height / 2;
        const color = `hsl(${Math.random() * 360}, 100%, 60%)`;

        for (let i = 0; i < 100; i++) {
          particles.push({
            x, y,
            radius: Math.random() * 2 + 1,
            dx: (Math.random() - 0.5) * 5,
            dy: (Math.random() - 0.5) * 5,
            alpha: 1,
            color
          });
        }
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
          p.x += p.dx;
          p.y += p.dy;
          p.alpha -= 0.01;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(${hexToRgb(p.color)}, ${p.alpha})`;
          ctx.fill();
          if (p.alpha <= 0) particles.splice(i, 1);
        });
        if (particles.length > 0) requestAnimationFrame(animate);
      }

      function hexToRgb(h) {
        const temp = document.createElement("div");
        temp.style.color = h;
        document.body.appendChild(temp);
        const rgb = window.getComputedStyle(temp).color;
        document.body.removeChild(temp);
        return rgb.match(/\d+,\s*\d+,\s*\d+/)[0];
      }

      createFirework();
      createFirework();
      createFirework();
      animate();

      setTimeout(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles = [];
      }, 3000);
    }
  </script>
</body>

</html>