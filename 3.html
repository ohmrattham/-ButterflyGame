<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f2f2f2;
      height: 100%;
    }

    .page {
      position: relative;
      width: 100%;
      max-width: 1080px;
      aspect-ratio: 9 / 16;
      margin: auto;
      background: #fff;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);

      background-image: url('bg33.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    #startScreen {
      position: absolute;
      inset: 0;
      background-image: url('bg33.png'); 
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }

    #startContent {
      background: white;
      padding: 5vw 8vw;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 1vh 2vh rgba(0, 0, 0, 0.2);
    }

    #startContent h1 {
      font-size: 5vw;
      color: #333;
    }

    #startContent p {
      font-size: 3.5vw;
      margin-bottom: 3vh;
      color: #444;
    }

    button {
      font-size: 3vw;
      padding: 1vh 3vh;
      border: none;
      border-radius: 1.5vh;
      cursor: pointer;
      box-shadow: 0 0.4vh 1vh rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    #startBtn,
    #checkBtn {
      background-color: #4caf50;
      color: white;
    }

    #resetBtn {
      background-color: #f44336;
      color: white;
    }

    button:hover {
      transform: scale(1.05);
      opacity: 0.9;
    }

    #game {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #bgImage {
      width: 100%;
      height: auto;
      display: block;
    }

    #overlayContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .drop-zone,
    .drag-option {
      position: absolute;
      width: 18%;
      height: 5%;
      border-radius: 10px;
      text-align: center;
      font-size: 2.2vh;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .drop-zone {
      border: 2px dashed #333;
      background-color: rgba(255, 255, 255, 0.7);
    }

    .drag-option {
      background-color: #ffcc66;
      cursor: grab;
    }

    #popup {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 5vw;
      border-radius: 20px;
      font-size: 4vw;
      font-weight: bold;
      display: none;
      z-index: 20;
      text-align: center;
      box-shadow: 0 0.4vh 1vh rgba(0, 0, 0, 0.3);
    }

    #checkBtn,
    #resetBtn {
      position: absolute;
      bottom: 5vh;
      padding: 1.5vh 3vh;
      font-size: 2.5vh;
      border-radius: 1.5vh;
    }

    #checkBtn {
      left: 35%;
      transform: translateX(-50%);
    }

    #resetBtn {
      left: 70%;
      transform: translateX(-50%);
    }

    #fireworks {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 10;
    }
  </style>
</head>

<body>
  <div class="page"
    style="background-image: url('bg33.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
    <audio id="successSound" src="success.mp3" preload="auto"></audio>
    <audio id="failSound" src="fail.mp3" preload="auto"></audio>
    <canvas id="fireworks"></canvas>

    <div id="startScreen">
      <div id="startContent" src="3.png">
        <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3</h1>
        <p>‡∏•‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
      </div>
    </div>

    <div id="game" style="display: none;">
      <audio id="bgm" src="bgmusic.mp3" autoplay loop hidden></audio>
      <img id="bgImage" src="3.png" alt="‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á" />
      <div id="overlayContainer"></div>

      <audio id="correctSound" src="correct.mp3"></audio>
      <audio id="wrongSound" src="wrong.mp3"></audio>
      <div id="popup"></div>
      <button id="checkBtn">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
      <button id="resetBtn">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
    </div>
  </div>

  <script>
    const dropZonesData = [
      { top: 30, left: 15, answer: "1" },
      { top: 32, left: 55, answer: "2" },
      { top: 59, left: 9, answer: "3" },
      { top: 71.5, left: 17, answer: "4" },
      { top: 71.5, left: 56, answer: "5" },
    ];

    const dragOptionsData = [
      { top: 12, left: 40, index: "1", text: "‡∏•‡∏≥‡∏ï‡∏±‡∏ß" },
      { top: 12, left: 65, index: "2", text: "‡∏´‡∏ô‡∏ß‡∏î" },
      { top: 20, left: 15, index: "3", text: "‡∏´‡∏±‡∏ß" },
      { top: 20, left: 40, index: "4", text: "‡∏õ‡∏µ‡∏Å" },
      { top: 20, left: 65, index: "5", text: "‡∏ó‡πâ‡∏≠‡∏á" },
    ];

    const correctAnswers = {
      1: "‡∏´‡∏ô‡∏ß‡∏î",
      2: "‡∏õ‡∏µ‡∏Å",
      3: "‡∏´‡∏±‡∏ß",
      4: "‡∏•‡∏≥‡∏ï‡∏±‡∏ß",
      5: "‡∏ó‡πâ‡∏≠‡∏á",
    };

    function createElements() {
      const container = document.getElementById("overlayContainer");
      container.innerHTML = '';
      dropZonesData.forEach(zone => {
        const div = document.createElement("div");
        div.className = "drop-zone";
        div.style.top = `${zone.top}%`;
        div.style.left = `${zone.left}%`;
        div.dataset.answer = zone.answer;
        container.appendChild(div);
      });
      dragOptionsData.forEach(opt => {
        const div = document.createElement("div");
        div.className = "drag-option";
        div.setAttribute("draggable", true);
        div.style.top = `${opt.top}%`;
        div.style.left = `${opt.left}%`;
        div.dataset.index = opt.index;
        div.innerText = opt.text;
        container.appendChild(div);
      });
    }

    function setupDragDrop() {
      const options = document.querySelectorAll(".drag-option");
      const zones = document.querySelectorAll(".drop-zone");
      let draggedElement = null;

      options.forEach(option => {
        option.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", option.dataset.index);
          draggedElement = option;
        });

        option.addEventListener("dragend", () => {
          draggedElement = null;
        });
      });

      zones.forEach(zone => {
        zone.addEventListener("dragover", e => e.preventDefault());
        zone.addEventListener("drop", e => {
          e.preventDefault();
          const index = e.dataTransfer.getData("text/plain");
          const dropped = document.querySelector(`.drag-option[data-index='${index}']`);
          if (!zone.innerText && dropped) {
            zone.innerText = dropped.innerText;
            zone.dataset.index = index;
            dropped.style.display = "none";
          }
        });
      });
    }

    document.getElementById("startBtn").addEventListener("click", () => {
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("game").style.display = "block";

      const bgMusic = document.getElementById("bgm");
      bgMusic.volume = 0.4;
      bgMusic.play().catch(err => console.log("Autoplay blocked:", err));

      if (!localStorage.getItem("firstVisit")) {
        const popup = document.getElementById("popup");
        popup.style.display = "block";
        popup.innerHTML = "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î";
        localStorage.setItem("firstVisit", "true");
        setTimeout(() => popup.style.display = "none", 5000);
      }
    });

    document.getElementById("checkBtn").addEventListener("click", () => {
      let correct = 0;
      document.querySelectorAll(".drop-zone").forEach(zone => {
        const expected = correctAnswers[zone.dataset.answer];
        if (zone.innerText === expected) correct++;
      });

      const popup = document.getElementById("popup");
      popup.style.display = "block";

      if (correct === Object.keys(correctAnswers).length) {
        document.getElementById("successSound").play();
        popup.innerHTML = "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î üéâ";
        startFireworks();
        localStorage.setItem("mission3Complete", "true");
        setTimeout(() => window.location.href = "index.html#map", 4000);
      } else {
        document.getElementById("failSound").play();
        popup.innerHTML = `‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å ${correct} ‡∏à‡∏≤‡∏Å ${Object.keys(correctAnswers).length} ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
        setTimeout(() => popup.style.display = "none", 3000);
      }
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      createElements();
      setupDragDrop();
    });

    window.addEventListener("load", () => {
      createElements();
      setupDragDrop();
    });

    function startFireworks() {
      const canvas = document.getElementById("fireworks");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      let particles = [];

      function createFirework() {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height / 2;
        const color = `hsl(${Math.random() * 360}, 100%, 60%)`;

        for (let i = 0; i < 100; i++) {
          particles.push({
            x, y,
            radius: Math.random() * 2 + 1,
            dx: (Math.random() - 0.5) * 5,
            dy: (Math.random() - 0.5) * 5,
            alpha: 1,
            color
          });
        }
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
          p.x += p.dx;
          p.y += p.dy;
          p.alpha -= 0.01;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(${hexToRgb(p.color)}, ${p.alpha})`;
          ctx.fill();
          if (p.alpha <= 0) particles.splice(i, 1);
        });
        if (particles.length > 0) requestAnimationFrame(animate);
      }

      function hexToRgb(h) {
        const temp = document.createElement("div");
        temp.style.color = h;
        document.body.appendChild(temp);
        const rgb = window.getComputedStyle(temp).color;
        document.body.removeChild(temp);
        return rgb.match(/\d+,\s*\d+,\s*\d+/)[0];
      }

      createFirework();
      createFirework();
      createFirework();
      animate();

      setTimeout(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles = [];
      }, 3000);
    }
  </script>
</body>

</html>